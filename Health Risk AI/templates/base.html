<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Diabetes Risk Prediction and Wellness Analytics</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in-up {
            animation: fadeInUp 0.8s ease-out forwards;
        }

        .delay-1 {
            animation-delay: 0.2s;
        }

        .delay-2 {
            animation-delay: 0.4s;
        }

        .delay-3 {
            animation-delay: 0.6s;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }

        .navbar {
            box-shadow: 0 2px 4px rgba(0, 0, 0, .05);
        }

        /* Custom Professional Styles */
        .hero-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 5rem 0;
            border-radius: 1rem;
            margin-bottom: 4rem;
            position: relative;
            overflow: hidden;
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(13, 110, 253, 0.1) 0%, rgba(0, 0, 0, 0) 70%);
            pointer-events: none;
        }

        .feature-card {
            background: white;
            border: none;
            border-radius: 12px;
            padding: 2rem;
            height: 100%;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .interactive-card {
            transition: transform 0.1s ease-out, box-shadow 0.3s ease;
            cursor: pointer;
            position: relative;
            z-index: 1;
            will-change: transform;
            transform-style: preserve-3d;
        }

        .interactive-card:hover {
            z-index: 10 !important;
            box-shadow: 0 30px 60px -15px rgba(0, 0, 0, 0.3) !important;
        }


        .icon-box {
            width: 60px;
            height: 60px;
            background: rgba(13, 110, 253, 0.1);
            color: #0d6efd;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .tech-pill {
            display: inline-block;
            padding: 0.5rem 1rem;
            background: #fff;
            border: 1px solid #eee;
            border-radius: 50px;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            font-weight: 500;
            color: #495057;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
            transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.2s;
            cursor: default;
        }

        .tech-pill:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            border-color: #dee2e6;
        }

        .section-title {
            font-weight: 700;
            letter-spacing: -0.5px;
            margin-bottom: 3rem;
            position: relative;
            display: inline-block;
        }

        .section-title::after {
            content: '';
            display: block;
            width: 40px;
            height: 4px;
            background: #0d6efd;
            margin-top: 10px;
            border-radius: 2px;
        }

        .hover-lift {
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.3s ease;
        }

        .hover-lift:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1) !important;
            z-index: 10;
            border-color: #0d6efd !important;
        }
    </style>
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
        <div class="container">
            <a class="navbar-brand fw-bold" href="/"> HealthRisk AI</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item"><a class="nav-link px-3" href="/">Home</a></li>
                    <li class="nav-item"><a class="nav-link px-3" href="/about">About</a></li>

                    {% if current_user.is_authenticated %}
                    {% if current_user.role == 'admin' %}
                    <li class="nav-item">
                        <a class="nav-link px-3 fw-bold" href="/admin/dashboard">
                            Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link px-3" href="/admin/patients">
                            <i class="fas fa-users-medical me-1"></i> Patient Management
                        </a>
                    </li>
                    {% else %}
                    <li class="nav-item"><a class="nav-link px-3" href="/predict">Risk Prediction</a></li>
                    <li class="nav-item"><a class="nav-link px-3" href="/dashboard">My Dashboard</a></li>
                    {% endif %}

                    <li class="nav-item"><a class="nav-link px-3" href="/services">Services</a></li>
                    <li class="nav-item"><a class="nav-link px-3" href="/contact">Contact</a></li>

                    <li class="nav-item ms-lg-3 border-start ps-lg-3 d-flex align-items-center">
                        <span class="navbar-text me-3 small text-white">
                            <i class="fas fa-user-circle me-1"></i> {{ current_user.name.split()[0] }}
                            <span class="badge bg-white text-primary ms-1 small px-2 py-1 rounded-pill"
                                style="font-size: 0.7rem;">
                                {{ current_user.role.upper() }}
                            </span>
                        </span>
                    </li>
                    <li class="nav-item">
                        <a class="btn btn-outline-light btn-sm rounded-pill px-3" href="/logout">Logout</a>
                    </li>
                    {% else %}
                    <li class="nav-item"><a class="nav-link px-3" href="/services">Services</a></li>
                    <li class="nav-item"><a class="nav-link px-3" href="/contact">Contact</a></li>
                    <li class="nav-item ms-lg-3">
                        <a class="nav-link px-3" href="/login">Login</a>
                    </li>
                    <li class="nav-item">
                        <a class="btn btn-light btn-sm rounded-pill px-4 text-primary fw-bold shadow-sm"
                            href="/signup">Sign Up</a>
                    </li>
                    {% endif %}

                    <!-- Sound Toggle -->
                    <li class="nav-item ms-2">
                        <button id="soundToggle" class="btn btn-link text-white p-2" title="Toggle Sound">
                            <i class="fas fa-volume-up"></i>
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        {% block content %}{% endblock %}
    </div>

    <!-- Footer -->
    {% if current_user.is_authenticated %}
    <footer class="bg-dark text-white py-5 mt-5">
        <div class="container">
            <div class="row g-4 align-items-center">
                <!-- Branding & Description -->
                <div class="col-lg-6 text-center text-lg-start">
                    <h5 class="fw-bold mb-3"> HealthRisk AI</h5>
                    <p class="text-white-50 small mb-0">
                        Empowering you with AI-driven health insights. Our mission is to make advanced clinical risk
                        assessment accessible, understandable, and actionable for everyone. Early detection saves lives.
                    </p>
                </div>

                <!-- Right Side: Links & Contact -->
                <div class="col-lg-6">
                    <div class="row g-4">
                        <!-- Quick Links -->
                        <div class="col-md-6 text-center text-lg-start">
                            <h5 class="fw-bold mb-3">Quick Links</h5>
                            <ul class="list-unstyled d-inline-block text-start">
                                <li><a href="/" class="text-white-50 text-decoration-none hover-white">Home</a></li>
                                <li><a href="/about" class="text-white-50 text-decoration-none hover-white">About</a>
                                </li>
                                <li><a href="/predict" class="text-white-50 text-decoration-none hover-white">Risk
                                        Prediction</a></li>
                                <li><a href="/dashboard"
                                        class="text-white-50 text-decoration-none hover-white">Dashboard</a></li>
                                <li><a href="/services"
                                        class="text-white-50 text-decoration-none hover-white">Services</a></li>
                                <li><a href="/contact"
                                        class="text-white-50 text-decoration-none hover-white">Contact</a></li>
                            </ul>
                        </div>

                        <!-- Contact Details -->
                        <div class="col-md-6 text-center text-lg-start">
                            <h5 class="fw-bold mb-3">Contact Us</h5>
                            <ul class="list-unstyled small text-white-50">
                                <li class="mb-3">
                                    <i class="fas fa-map-marker-alt text-primary me-2"></i>
                                    RVS Towers, RVS Nagar,<br>Chittoor, AP, India
                                </li>
                                <li class="mb-3">
                                    <i class="fas fa-envelope text-primary me-2"></i>
                                    <a href="mailto:support@healthrisk.ai"
                                        class="text-white-50 text-decoration-none">support@healthrisk.ai</a>
                                </li>
                                <li class="mb-3">
                                    <i class="fas fa-phone text-primary me-2"></i>
                                    <a href="tel:+919876543210" class="text-white-50 text-decoration-none">+91 98765
                                        43210</a>
                                </li>
                                <li>
                                    <a href="https://wa.me/919876543210" target="_blank"
                                        class="text-success text-decoration-none fw-bold">
                                        <i class="fab fa-whatsapp me-2"></i>Chat on WhatsApp
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <hr class="my-4 border-secondary opacity-25">
            <div class="row align-items-center">
                <div class="col-md-6 text-center text-md-start">
                    <small class="text-white-50">&copy; 2026 HealthRisk AI. All rights reserved.</small>
                </div>
                <div class="col-md-6 text-center text-md-end">
                    <small class="text-white-50">
                        <a href="#" class="text-white-50 text-decoration-none me-2">Privacy Policy</a> |
                        <a href="#" class="text-white-50 text-decoration-none ms-2">Terms of Service</a>
                    </small>
                </div>
            </div>
        </div>
    </footer>
    {% endif %}

    <!-- Bootstrap JS -->
    <!-- AI Floating Chatbot (Restricted to logged-in users) -->
    {% if current_user.is_authenticated %}
    <div id="chatbot-container"
        class="position-fixed bottom-0 end-0 m-4 shadow-lg rounded-4 overflow-hidden d-none animate-fade-in-up"
        style="width: 350px; height: 500px; z-index: 1050; background: white; border: 1px solid #eee;">
        <div class="bg-primary text-white p-3 d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center">
                <i class="fas fa-robot me-2"></i>
                <span class="fw-bold">HealthRisk AI Assistant</span>
            </div>
            <button id="closeChat" class="btn btn-link text-white p-0"><i class="fas fa-times"></i></button>
        </div>
        <div id="chatMessages" class="p-3 overflow-auto" style="height: 380px; font-size: 0.9rem; background: #fdfdfd;">
            <div class="chat-msg bot mb-3">
                <div class="p-2 bg-light rounded-3 text-dark d-inline-block shadow-sm">
                    Hello {{ current_user.name.split()[0] }}! I'm your AI health assistant. I can analyze your vitals
                    and answer your health questions. What's on your mind?
                </div>
            </div>
        </div>
        <div class="p-2 border-top bg-white">
            <div class="input-group">
                <input type="text" id="chatInput" class="form-control rounded-pill-start border-0 bg-light"
                    placeholder="Ask a question..." style="box-shadow: none;">
                <button id="sendChat" class="btn btn-primary rounded-pill-end"><i
                        class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <!-- Chat Trigger -->
    <button id="chatTrigger" class="btn btn-primary position-fixed bottom-0 end-0 m-4 rounded-circle shadow-lg"
        style="width: 60px; height: 60px; z-index: 1040;">
        <i class="fas fa-comments fa-lg"></i>
    </button>
    {% endif %}
    <!-- End Chatbot -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Sound Manager & Interaction Logic -->
    <script>
        class SoundManager {
            constructor() {
                this.muted = localStorage.getItem('soundMuted') === 'true';
                this.sounds = {
                    click: 'https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3',  // Minimal Pop
                    notif: 'https://assets.mixkit.co/active_storage/sfx/2354/2354-preview.mp3'   // Soft Chime
                };
                this.initUI();
            }

            initUI() {
                this.updateIcon();
                const toggle = document.getElementById('soundToggle');
                if (toggle) toggle.addEventListener('click', () => this.toggle());
            }

            toggle() {
                this.muted = !this.muted;
                localStorage.setItem('soundMuted', this.muted);
                this.updateIcon();
            }

            updateIcon() {
                const icon = document.querySelector('#soundToggle i');
                if (icon) icon.className = this.muted ? 'fas fa-volume-mute text-danger' : 'fas fa-volume-up';
            }

            play(key) {
                if (this.muted || !this.sounds[key]) return;
                try {
                    const audio = new Audio(this.sounds[key]);
                    audio.volume = 0.6;
                    audio.play().catch(e => console.log('Audio blocked:', e));
                } catch (e) {
                    console.error('Audio error:', e);
                }
            }
        }

        window.sounds = new SoundManager();

        // Click sounds for buttons
        document.querySelectorAll('.btn:not(.nav-link), #chatTrigger, #sendChat').forEach(el => {
            el.addEventListener('click', () => window.sounds.play('click'));
        });

        // Specialized Navbar Navigation with Sound
        document.querySelectorAll('.nav-link, .navbar-brand').forEach(el => {
            el.addEventListener('click', (e) => {
                const href = el.getAttribute('href');
                if (!href || href.startsWith('#')) return;

                e.preventDefault();
                window.sounds.play('click'); // Use click instead of notif for nav

                // Short delay to allow sound to start/play before navigation
                setTimeout(() => {
                    window.location.href = href;
                }, 150);
            });
        });

        // Chatbot Logic
        const chatContainer = document.getElementById('chatbot-container');
        const chatTrigger = document.getElementById('chatTrigger');
        const closeChat = document.getElementById('closeChat');
        const sendBtn = document.getElementById('sendChat');
        const chatInput = document.getElementById('chatInput');
        const chatMessages = document.getElementById('chatMessages');

        if (chatTrigger && chatContainer) {
            chatTrigger.addEventListener('click', () => {
                chatContainer.classList.remove('d-none');
                chatTrigger.classList.add('d-none');
                window.sounds.play('notif');
            });

            if (closeChat) {
                closeChat.addEventListener('click', () => {
                    chatContainer.classList.add('d-none');
                    chatTrigger.classList.remove('d-none');
                });
            }

            if (sendBtn) {
                sendBtn.addEventListener('click', handleChat);
            }

            if (chatInput) {
                chatInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleChat(); });
            }
        }

        function appendMessage(sender, text) {
            const side = sender === 'me' ? 'text-end' : 'text-start';
            const bg = sender === 'me' ? 'bg-primary text-white' : 'bg-light text-dark';
            const html = `
                <div class="chat-msg ${sender} mb-3 ${side}">
                    <div class="p-2 ${bg} rounded-3 d-inline-block shadow-sm" style="max-width: 80%;">
                        ${text}
                    </div>
                </div>
            `;
            chatMessages.insertAdjacentHTML('beforeend', html);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        async function handleChat() {
            const text = chatInput.value.trim();
            if (!text) return;

            appendMessage('me', text);
            chatInput.value = '';

            // Show typing indicator or just delay
            setTimeout(async () => {
                try {
                    const response = await fetch('/api/chat', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ message: text })
                    });

                    if (!response.ok) {
                        if (response.status === 401) {
                            appendMessage('bot', "Your session has expired. Please refresh the page and log in again.");
                            return;
                        }
                        throw new Error('Network response was not ok');
                    }

                    const data = await response.json();
                    appendMessage('bot', data.reply);
                    window.sounds.play('notif');
                } catch (e) {
                    console.error('Chat Error:', e);
                    appendMessage('bot', "I'm having a little trouble connecting to my cloud brain right now. Please try again in a moment!");
                }
            }, 600);
        }

        // Global 3D Interactive Card Logic
        const initInteractiveCards = () => {
            const cards = document.querySelectorAll('.interactive-card');
            cards.forEach(card => {
                card.onmousemove = (e) => {
                    const rect = card.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    const centerX = rect.width / 2;
                    const centerY = rect.height / 2;

                    const rotateX = (y - centerY) / 15;
                    const rotateY = (centerX - x) / 15;

                    card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(1.03, 1.03, 1.03)`;
                    card.style.boxShadow = "0 20px 40px -10px rgba(0, 0, 0, 0.15)";
                };

                card.onmouseleave = () => {
                    card.style.transform = "perspective(1000px) rotateX(0deg) rotateY(0deg) scale3d(1, 1, 1)";
                    card.style.boxShadow = "";
                };
            });
        };

        document.addEventListener("DOMContentLoaded", initInteractiveCards);
        initInteractiveCards();

    </script>
</body>

</html>